<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Pomodoro Timer - Focus & Productivity</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Free Pomodoro timer for better focus and productivity" />
	<meta name="keywords" content="pomodoro timer, focus timer, productivity, study timer" />
	<meta name="author" content="Yusuf Morsi" />

	<!-- Favicon -->
	<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='12' fill='%231e3a8a'/%3E%3Cpath d='M20 25 L20 75 L80 75 L80 45 L60 45 L60 25 Z' fill='white'/%3E%3Cpath d='M60 25 L60 45 L80 45 Z' fill='%233b82f6'/%3E%3C/svg%3E">

	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		:root {
			--blue-primary: #1e3a8a;
			--blue-dark: #1e40af;
			--blue-light: #3b82f6;
			--blue-hover: #2563eb;
			--green: #10b981;
			--red: #ef4444;
			--text-dark: #1e293b;
			--text-medium: #475569;
			--bg-white: #ffffff;
			--bg-light: #f1f5f9;
			--border-color: #e2e8f0;
		}

		body {
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: var(--text-dark);
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 2rem;
			position: relative;
		}

		#logo {
			position: absolute;
			top: 10px;
			left: 10px;
			cursor: pointer;
			display: flex;
			align-items: center;
			z-index: 1000;
		}
		#logo img {
			width: 40px;
			height: 40px;
			border-radius: 50%;
		}
		#logo .tooltip {
			position: absolute;
			left: 50px;
			background: rgba(0, 0, 0, 0.8);
			color: white;
			padding: 5px 10px;
			border-radius: 4px;
			font-size: 12px;
			white-space: nowrap;
			opacity: 0;
			visibility: hidden;
			transform: translateX(-10px);
			transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
			pointer-events: none;
		}
		#logo img:hover + .tooltip,
		#logo .tooltip:hover {
			opacity: 1;
			visibility: visible;
			transform: translateX(0);
		}

		.container {
			background: white;
			border-radius: 20px;
			padding: 3rem;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
			max-width: 600px;
			width: 100%;
			text-align: center;
		}

		.header {
			margin-bottom: 2rem;
		}

		.header h1 {
			font-size: 2.5rem;
			font-weight: 700;
			color: var(--blue-primary);
			margin-bottom: 0.5rem;
		}

		.header p {
			color: var(--text-medium);
			font-size: 1rem;
		}

		.timer-display {
			font-size: 5rem;
			font-weight: 700;
			color: var(--blue-primary);
			margin: 2rem 0;
			font-variant-numeric: tabular-nums;
		}

		.mode-indicator {
			font-size: 1.25rem;
			color: var(--text-medium);
			margin-bottom: 1rem;
			font-weight: 600;
		}

		.mode-indicator.work {
			color: var(--blue-primary);
		}

		.mode-indicator.break {
			color: var(--green);
		}

		.controls {
			display: flex;
			gap: 1rem;
			justify-content: center;
			margin: 2rem 0;
		}

		.btn {
			padding: 1rem 2rem;
			border: none;
			border-radius: 12px;
			font-size: 1rem;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s ease;
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		.btn-primary {
			background: var(--blue-primary);
			color: white;
		}

		.btn-primary:hover {
			background: var(--blue-hover);
		}

		.btn-secondary {
			background: var(--bg-light);
			color: var(--text-dark);
		}

		.btn-secondary:hover {
			background: var(--border-color);
		}

		.btn-danger {
			background: var(--red);
			color: white;
		}

		.btn-danger:hover {
			background: #dc2626;
		}

		.settings {
			margin-top: 2rem;
			padding-top: 2rem;
			border-top: 2px solid var(--border-color);
		}

		.settings h3 {
			font-size: 1.25rem;
			margin-bottom: 1rem;
			color: var(--text-dark);
		}

		.setting-group {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 1rem;
			margin-bottom: 1rem;
		}

		.setting-item {
			text-align: left;
		}

		.setting-item label {
			display: block;
			margin-bottom: 0.5rem;
			font-weight: 600;
			color: var(--text-medium);
			font-size: 0.9rem;
		}

		.setting-item input {
			width: 100%;
			padding: 0.75rem;
			border: 2px solid var(--border-color);
			border-radius: 8px;
			font-size: 1rem;
			font-family: inherit;
		}

		.setting-item input:focus {
			outline: none;
			border-color: var(--blue-primary);
		}

		.footer {
			margin-top: 2rem;
			padding-top: 2rem;
			border-top: 2px solid var(--border-color);
		}

		.footer a {
			color: var(--blue-primary);
			text-decoration: none;
			font-weight: 500;
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
		}

		.footer a:hover {
			color: var(--blue-hover);
		}

		.progress-bar {
			width: 100%;
			height: 8px;
			background: var(--bg-light);
			border-radius: 4px;
			overflow: hidden;
			margin: 1rem 0;
		}

		.progress-fill {
			height: 100%;
			background: var(--blue-primary);
			transition: width 0.3s ease;
			width: 0%;
		}

		.progress-fill.break {
			background: var(--green);
		}

		@media screen and (max-width: 768px) {
			.container {
				padding: 2rem 1.5rem;
			}

			.timer-display {
				font-size: 4rem;
			}

			.controls {
				flex-direction: column;
			}

			.btn {
				width: 100%;
				justify-content: center;
			}
		}
	</style>
</head>

<body>
	<div id="logo" onclick="window.location.href='https://ymorsi.com';">
		<img src="images/smiling.png" alt="YM Home">
		<div class="tooltip">YM - Home</div>
	</div>
	<div class="container">
		<div class="header">
			<h1><i class="fas fa-clock"></i> Pomodoro Timer</h1>
			<p>Focus for 50 minutes, rest for 10 minutes</p>
			<div id="notification-status" style="margin-top: 0.5rem; font-size: 0.85rem;">
				<button id="test-notification-btn" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.85rem; margin-top: 0.5rem;">
					<i class="fas fa-bell"></i> Test Notifications
				</button>
				<p id="notification-status-text" style="margin-top: 0.5rem; color: var(--text-medium);"></p>
			</div>
		</div>

		<div class="mode-indicator work" id="mode-indicator">Work Session</div>
		
		<div class="timer-display" id="timer">50:00</div>

		<div class="progress-bar">
			<div class="progress-fill" id="progress"></div>
		</div>

		<div class="controls">
			<button class="btn btn-primary" id="start-btn">
				<i class="fas fa-play"></i> Start
			</button>
			<button class="btn btn-secondary" id="pause-btn" style="display: none;">
				<i class="fas fa-pause"></i> Pause
			</button>
			<button class="btn btn-danger" id="reset-btn">
				<i class="fas fa-redo"></i> Reset
			</button>
		</div>

		<div class="settings">
			<h3>Timer Settings</h3>
			<div class="setting-group">
				<div class="setting-item">
					<label>Work Duration (minutes)</label>
					<input type="number" id="work-duration" value="50" min="1" max="120">
				</div>
				<div class="setting-item">
					<label>Break Duration (minutes)</label>
					<input type="number" id="break-duration" value="10" min="1" max="60">
				</div>
			</div>
		</div>

		<div class="footer">
			<a href="index.html">
				<i class="fas fa-arrow-left"></i> Back to Portfolio
			</a>
			<span style="margin: 0 1rem; color: var(--text-medium);">|</span>
			<a href="tools.html">
				<i class="fas fa-tools"></i> More Tools
			</a>
		</div>
	</div>

	<script>
		let timerInterval = null;
		let timeLeft = 50 * 60; // 50 minutes in seconds
		let isRunning = false;
		let isWorkMode = true;
		let workDuration = 50;
		let breakDuration = 10;
		let totalTime = 50 * 60;

		const timerDisplay = document.getElementById('timer');
		const modeIndicator = document.getElementById('mode-indicator');
		const progressBar = document.getElementById('progress');
		const startBtn = document.getElementById('start-btn');
		const pauseBtn = document.getElementById('pause-btn');
		const resetBtn = document.getElementById('reset-btn');
		const workInput = document.getElementById('work-duration');
		const breakInput = document.getElementById('break-duration');
		let alarmInterval = null;
		let endTime = null; // Track when timer should end (for background accuracy)
		let alarmActive = false; // Track if alarm should be playing
		let notificationInterval = null; // Keep showing notifications

		const notificationStatusText = document.getElementById('notification-status-text');
		const testNotificationBtn = document.getElementById('test-notification-btn');

		function updateNotificationStatus() {
			if (!('Notification' in window)) {
				notificationStatusText.textContent = 'âš ï¸ Notifications not supported in this browser';
				notificationStatusText.style.color = 'var(--red)';
				return;
			}

			const permission = Notification.permission;
			if (permission === 'granted') {
				notificationStatusText.textContent = 'âœ… Notifications enabled';
				notificationStatusText.style.color = 'var(--green)';
			} else if (permission === 'denied') {
				notificationStatusText.textContent = 'âŒ Notifications blocked - enable in browser settings';
				notificationStatusText.style.color = 'var(--red)';
			} else {
				notificationStatusText.textContent = 'â³ Click "Test Notifications" to enable';
				notificationStatusText.style.color = 'var(--text-medium)';
			}
		}

		// Request notification permission on page load
		if ('Notification' in window && Notification.permission === 'default') {
			Notification.requestPermission().then(() => updateNotificationStatus());
		}

		// Test notification button
		testNotificationBtn.addEventListener('click', async () => {
			if (!('Notification' in window)) {
				alert('Notifications are not supported in this browser.');
				return;
			}

			let permission = Notification.permission;
			if (permission === 'default') {
				permission = await Notification.requestPermission();
			}

			updateNotificationStatus();

			if (permission === 'granted') {
				// Test notification
				const notification = new Notification('ðŸ”” Test Notification', {
					body: 'If you see this, notifications are working!',
					icon: 'images/smiling.png',
					tag: 'test',
					requireInteraction: true,
					silent: false
				});

				// Test alarm sound
				try {
					const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGWi77+efTRAMUKfj8LZjHAY4kdfyzHksBSR3x/DdkEAKFF606euoVRQKRp/g8r5sIQUrgc7y2Yk2CBlo');
					audio.volume = 1.0;
					audio.play().then(() => {
						console.log('Test alarm played successfully');
					}).catch(err => {
						console.error('Failed to play test alarm:', err);
						alert('Audio test failed. Make sure your browser allows audio and the tab is not muted.');
					});
				} catch (e) {
					console.error('Error creating test audio:', e);
				}

				setTimeout(() => notification.close(), 5000);
			} else if (permission === 'denied') {
				alert('Notifications are blocked. Please enable them in your browser settings for this site.');
			}
		});

		function showNotification(title, body) {
			console.log('showNotification called:', title, body);
			
			if (!('Notification' in window)) {
				console.error('Notifications not supported');
				// Fallback: use alert
				alert(`${title}\n${body}`);
				return;
			}

			if (Notification.permission === 'granted') {
				try {
					// Show notification immediately
					const showOne = () => {
						try {
							const notification = new Notification(title, {
								body: body,
								icon: 'images/smiling.png',
								badge: 'images/smiling.png',
								tag: 'pomodoro-timer',
								requireInteraction: true,
								silent: false
							});

							console.log('Notification created:', notification);

							// Keep notification open longer
							setTimeout(() => notification.close(), 30000);

							// Focus window when notification is clicked
							notification.onclick = () => {
								window.focus();
								notification.close();
								// Stop showing more notifications when clicked
								if (notificationInterval) {
									clearInterval(notificationInterval);
									notificationInterval = null;
								}
							};

							notification.onerror = (e) => {
								console.error('Notification error:', e);
							};
						} catch (e) {
							console.error('Error creating notification:', e);
							alert(`${title}\n${body}`);
						}
					};

					// Show immediately
					showOne();
					
					// Keep showing notifications every 5 seconds until user interacts
					if (!notificationInterval) {
						notificationInterval = setInterval(() => {
							if (alarmActive) {
								showOne();
							} else {
								clearInterval(notificationInterval);
								notificationInterval = null;
							}
						}, 5000);
					}
				} catch (e) {
					console.error('Error in showNotification:', e);
					alert(`${title}\n${body}`);
				}
			} else if (Notification.permission === 'default') {
				// Request permission if not yet asked
				Notification.requestPermission().then(permission => {
					updateNotificationStatus();
					if (permission === 'granted') {
						showNotification(title, body);
					} else {
						alert(`${title}\n${body}`);
					}
				});
			} else {
				// Permission denied - use alert as fallback
				console.warn('Notification permission denied, using alert');
				alert(`${title}\n${body}`);
			}
		}

		// Update status on load
		updateNotificationStatus();

		function playAlarm() {
			console.log('playAlarm called');
			// Mark alarm as active
			alarmActive = true;
			
			// Stop any existing alarm
			if (alarmInterval) {
				clearInterval(alarmInterval);
			}

			// Create a more noticeable beep pattern
			const playBeep = () => {
				try {
					const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGWi77+efTRAMUKfj8LZjHAY4kdfyzHksBSR3x/DdkEAKFF606euoVRQKRp/g8r5sIQUrgc7y2Yk2CBlo');
					audio.volume = 1.0; // Maximum volume
					audio.play().then(() => {
						console.log('Beep played successfully');
					}).catch(err => {
						console.error('Failed to play beep:', err);
					});
				} catch (e) {
					console.error('Error creating audio:', e);
				}
			};

			// Play beeps in a pattern: beep every second
			let beepCount = 0;
			alarmInterval = setInterval(() => {
				// Only play if tab is visible (browsers block background audio)
				if (!document.hidden) {
					playBeep();
				}
				beepCount++;
				
				// Play for 120 seconds total (2 minutes) - very persistent
				if (beepCount >= 120) {
					clearInterval(alarmInterval);
					alarmInterval = null;
					alarmActive = false;
					// Stop notifications too
					if (notificationInterval) {
						clearInterval(notificationInterval);
						notificationInterval = null;
					}
				}
			}, 1000);

			// Play immediately if tab is visible
			if (!document.hidden) {
				playBeep();
				setTimeout(playBeep, 200);
				setTimeout(playBeep, 400);
				setTimeout(playBeep, 600);
				setTimeout(playBeep, 800);
			}
		}

		function flashPage() {
			// Flash the page background to get attention
			let flashCount = 0;
			const flashInterval = setInterval(() => {
				if (flashCount % 2 === 0) {
					document.body.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
				} else {
					document.body.style.background = isWorkMode 
						? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
						: 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
				}
				flashCount++;
				if (flashCount >= 20) { // Flash for 10 seconds
					clearInterval(flashInterval);
				}
			}, 500);
		}

		function updateDisplay() {
			const minutes = Math.floor(timeLeft / 60);
			const seconds = timeLeft % 60;
			const timeString = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
			timerDisplay.textContent = timeString;
			
			const progress = ((totalTime - timeLeft) / totalTime) * 100;
			progressBar.style.width = progress + '%';
			
			// Update tab title with countdown
			if (isRunning) {
				const modeText = isWorkMode ? 'Work' : 'Break';
				document.title = `${timeString} - ${modeText} | Pomodoro Timer`;
			} else {
				document.title = 'Pomodoro Timer - Focus & Productivity';
			}
		}

		function calculateTimeLeft() {
			if (endTime && isRunning) {
				const now = Date.now();
				const remaining = Math.max(0, Math.floor((endTime - now) / 1000));
				return remaining;
			}
			return timeLeft;
		}

		function startTimer() {
			if (timerInterval) return;
			
			// Stop any active alarm when starting new session
			if (alarmInterval) {
				clearInterval(alarmInterval);
				alarmInterval = null;
			}
			// Stop notifications
			if (notificationInterval) {
				clearInterval(notificationInterval);
				notificationInterval = null;
			}
			alarmActive = false;
			
			// Request notification permission if not already granted
			if ('Notification' in window && Notification.permission === 'default') {
				Notification.requestPermission();
			}
			
			isRunning = true;
			startBtn.style.display = 'none';
			pauseBtn.style.display = 'inline-flex';
			
			// Set end time based on current timeLeft (works even when tab is inactive)
			endTime = Date.now() + (timeLeft * 1000);
			
			timerInterval = setInterval(() => {
				timeLeft = calculateTimeLeft();
				updateDisplay();
				
				if (timeLeft <= 0) {
					console.log('Timer completed!');
					clearInterval(timerInterval);
					timerInterval = null;
					endTime = null;
					
					// Store the mode we just completed for notifications
					const completedWorkMode = isWorkMode;
					
					// Switch mode
					if (isWorkMode) {
						isWorkMode = false;
						timeLeft = breakDuration * 60;
						totalTime = breakDuration * 60;
						modeIndicator.textContent = 'Break Time!';
						modeIndicator.className = 'mode-indicator break';
						progressBar.className = 'progress-fill break';
						document.body.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
					} else {
						isWorkMode = true;
						timeLeft = workDuration * 60;
						totalTime = workDuration * 60;
						modeIndicator.textContent = 'Work Session';
						modeIndicator.className = 'mode-indicator work';
						progressBar.className = 'progress-fill';
						document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
					}
					
					updateDisplay();
					
					// MULTIPLE ALARM METHODS - Make it impossible to miss!
					console.log('Triggering alarms...');
					// 1. Browser notification (works even when tab is inactive) - show multiple times
					if (completedWorkMode) {
						showNotification('â° Break Time! ðŸŽ‰', `Your ${workDuration}-minute work session is complete. Time for a ${breakDuration}-minute break!`);
					} else {
						showNotification('â° Work Session! ðŸ’ª', `Break is over. Time to focus for ${workDuration} minutes!`);
					}
					
					// 2. Play alarm sound repeatedly for 30 seconds
					playAlarm();
					
					// 3. Flash the page background
					flashPage();
					
					// 4. Update tab title to show alert
					document.title = 'â° TIMER COMPLETE! - Pomodoro Timer';
					
					// Auto-start next session
					setTimeout(() => {
						if (confirm(isWorkMode ? 'Start work session?' : 'Start break?')) {
							startTimer();
						} else {
							isRunning = false;
							startBtn.style.display = 'inline-flex';
							pauseBtn.style.display = 'none';
						}
					}, 1000);
				}
			}, 1000);
		}

		function pauseTimer() {
			if (timerInterval) {
				clearInterval(timerInterval);
				timerInterval = null;
				isRunning = false;
				endTime = null;
				startBtn.style.display = 'inline-flex';
				pauseBtn.style.display = 'none';
			}
			// Stop any ongoing alarm
			if (alarmInterval) {
				clearInterval(alarmInterval);
				alarmInterval = null;
			}
			// Stop notifications
			if (notificationInterval) {
				clearInterval(notificationInterval);
				notificationInterval = null;
			}
			alarmActive = false;
		}

		function resetTimer() {
			pauseTimer();
			// Stop any ongoing alarm
			if (alarmInterval) {
				clearInterval(alarmInterval);
				alarmInterval = null;
			}
			// Stop notifications
			if (notificationInterval) {
				clearInterval(notificationInterval);
				notificationInterval = null;
			}
			alarmActive = false;
			endTime = null;
			isWorkMode = true;
			workDuration = parseInt(workInput.value) || 50;
			breakDuration = parseInt(breakInput.value) || 10;
			timeLeft = workDuration * 60;
			totalTime = workDuration * 60;
			modeIndicator.textContent = 'Work Session';
			modeIndicator.className = 'mode-indicator work';
			progressBar.className = 'progress-fill';
			document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
			updateDisplay();
		}

		startBtn.addEventListener('click', startTimer);
		pauseBtn.addEventListener('click', pauseTimer);
		resetBtn.addEventListener('click', resetTimer);

		workInput.addEventListener('change', () => {
			if (!isRunning) {
				workDuration = parseInt(workInput.value) || 50;
				if (isWorkMode) {
					timeLeft = workDuration * 60;
					totalTime = workDuration * 60;
					updateDisplay();
				}
			}
		});

		breakInput.addEventListener('change', () => {
			if (!isRunning) {
				breakDuration = parseInt(breakInput.value) || 10;
				if (!isWorkMode) {
					timeLeft = breakDuration * 60;
					totalTime = breakDuration * 60;
					updateDisplay();
				}
			}
		});

		// Handle tab visibility changes - play alarm when you return to tab if it's active
		document.addEventListener('visibilitychange', () => {
			if (!document.hidden) {
				// Tab became visible - recalculate time left
				if (isRunning && endTime) {
					timeLeft = calculateTimeLeft();
					updateDisplay();
				}
				
				// If alarm should be playing, play it IMMEDIATELY and LOUDLY
				if (alarmActive) {
					// Restart alarm to ensure it plays (even if already playing)
					if (alarmInterval) {
						clearInterval(alarmInterval);
						alarmInterval = null;
					}
					// Play multiple beeps immediately
					for (let i = 0; i < 10; i++) {
						setTimeout(() => {
							try {
								const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGWi77+efTRAMUKfj8LZjHAY4kdfyzHksBSR3x/DdkEAKFF606euoVRQKRp/g8r5sIQUrgc7y2Yk2CBlo');
								audio.volume = 1.0;
								audio.play().catch(() => {});
							} catch (e) {}
						}, i * 100);
					}
					// Then start the regular alarm pattern
					playAlarm();
				}
			}
		});

		updateDisplay();
	</script>
</body>

</html>

